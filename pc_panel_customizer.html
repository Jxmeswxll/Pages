<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom PC Panel Designer</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 700px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .upload-section, .editor-section, .preview-section {
            margin-bottom: 30px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        input[type="file"] {
            display: block;
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: calc(100% - 22px); /* Account for padding and border */
        }
        .image-editor {
            position: relative; /* For absolute positioning of children */
            width: 300px; /* Should match panelWidth */
            height: 450px; /* Should match panelHeight */
            margin: 0 auto 20px; /* Center it and add some margin */
            border: 1px solid #eee; /* Optional: border for the editor area */
        }
        .panel-outline-container { /* This holds the SVG background */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('Testing/Zeal Pastel/zeal print preview.svg');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            z-index: 1; /* Behind the cropper image container */
        }
        .image-to-crop-container { /* This holds the img Cropper.js will attach to */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none; /* Hidden until image is uploaded */
            z-index: 2; /* On top of the panel outline SVG */
        }
        /* Style the image Cropper.js uses, and the canvas it creates */
        .image-to-crop-container img, .cropper-canvas img {
            opacity: 0.7; /* Make uploaded image semi-transparent to see SVG behind */
            max-width: 100%;
            display: block; /* Cropper.js requirement */
        }
        .controls button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            transition: background-color 0.3s ease;
        }
        .controls button:hover {
            background-color: #0056b3;
        }
        .controls button#addToCartBtn {
            background-color: #28a745;
        }
        .controls button#addToCartBtn:hover {
            background-color: #1e7e34;
        }
        .preview-area img {
            max-width: 100%;
            border: 1px solid #ddd;
            margin-top: 10px;
            border-radius: 4px;
            background-color: #fff; /* Ensure preview has solid background if image has transparency */
        }
        .instructions {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Design Your Custom PC Panel</h1>

        <div class="upload-section">
            <label for="imageUpload">1. Upload Your Image:</label>
            <input type="file" id="imageUpload" accept="image/*">
            <p class="instructions">
                This image will be placed over the panel outline. You can then position and crop it.
            </p>
        </div>

        <div class="editor-section">
            <label>2. Position and Crop Your Image:</label>
            <div class="image-editor">
                <div class="panel-outline-container" id="panelOutline">
                    {/* SVG background is applied via CSS to this div */}
                </div>
                <div class="image-to-crop-container" id="imageCropContainer">
                    <img id="imageToCrop" src="#" alt="Uploaded Image">
                </div>
            </div>
             <p class="instructions" id="cropInstructions" style="display:none;">
                Adjust the selection over your image. The selection is constrained to the panel's shape.
            </p>
        </div>

        <div class="controls">
            <button id="cropBtn" style="display:none;">Crop & Preview</button>
            <button id="addToCartBtn" style="display:none;">Add to Basket (Conceptual)</button>
        </div>

        <div class="preview-section">
            <label>3. Preview:</label>
            <div id="previewArea" class="preview-area">
                <p id="previewPlaceholder">Your cropped panel design will appear here.</p>
            </div>
        </div>
    </div>

    <script>
        const imageUpload = document.getElementById('imageUpload');
        const imageToCropContainer = document.getElementById('imageCropContainer');
        const imageToCrop = document.getElementById('imageToCrop');
        // panelOutline div is now just for the SVG background, not directly used by JS logic here
        const cropBtn = document.getElementById('cropBtn');
        const addToCartBtn = document.getElementById('addToCartBtn');
        const previewArea = document.getElementById('previewArea');
        const previewPlaceholder = document.getElementById('previewPlaceholder');
        const cropInstructions = document.getElementById('cropInstructions');
        let cropper;

        const panelWidth = 300; // Target width for the final cropped image
        const panelHeight = 450; // Target height for the final cropped image

        imageUpload.addEventListener('change', (event) => {
            const files = event.target.files;
            if (files && files.length > 0) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    imageToCrop.src = e.target.result;
                    imageToCropContainer.style.display = 'block';
                    cropInstructions.style.display = 'block';

                    if (cropper) {
                        cropper.destroy();
                    }

                    cropper = new Cropper(imageToCrop, {
                        aspectRatio: panelWidth / panelHeight, // Constrain crop box to panel's aspect ratio
                        viewMode: 1, // Restrict crop box to be within the image bounds.
                                     // Use 0 if you want the crop box to be able to go outside image bounds,
                                     // but then parts of the crop box might be empty.
                        dragMode: 'crop', // Allows creating a new crop box or moving/resizing existing one
                        autoCropArea: 0.8, // Initial size of crop box (e.g., 80% of image)
                        responsive: true,
                        modal: true, // Dark overlay outside crop box
                        guides: true,
                        center: true,
                        highlight: true,
                        background: true, // Shows grid background in cropper, helps with transparency
                        cropBoxMovable: true,
                        cropBoxResizable: true,
                        toggleDragModeOnDblclick: false
                    });
                    cropBtn.style.display = 'inline-block';
                };
                reader.readAsDataURL(files[0]);
            }
        });

        cropBtn.addEventListener('click', () => {
            if (cropper) {
                const croppedCanvas = cropper.getCroppedCanvas({
                    width: panelWidth,    // Output width for the preview
                    height: panelHeight,  // Output height for the preview
                    imageSmoothingEnabled: true,
                    imageSmoothingQuality: 'high'
                });

                if (croppedCanvas) {
                    previewPlaceholder.style.display = 'none';
                    previewArea.innerHTML = ''; // Clear previous preview
                    const croppedImageEl = document.createElement('img');
                    croppedImageEl.src = croppedCanvas.toDataURL('image/png');
                    previewArea.appendChild(croppedImageEl);
                    addToCartBtn.style.display = 'inline-block';
                } else {
                    alert("Could not crop the image. Please try again.");
                }
            }
        });

        addToCartBtn.addEventListener('click', () => {
            if (cropper && cropper.getCroppedCanvas()) {
                const base64ImageData = cropper.getCroppedCanvas({width: panelWidth, height: panelHeight}).toDataURL('image/png');
                alert('Conceptual: "Add to Basket" clicked. Image data (see console) would be sent to Shopify here.');
                console.log("Base64 Image data for Shopify:", base64ImageData);
                // Shopify integration logic would go here
            } else {
                alert("Please crop an image first.");
            }
        });
    </script>
</body>
</html>
