<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Atelier T3 | Bespoke Systems</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Space+Grotesk:wght@300;400;600&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
      :root {
        --bg-color: #f2f0e9;
        --text-main: #1a1a1a;
        --accent: #cd5c45;
        --surface: #ffffff;
        --cursor-size: 20px;
      }

      body {
        background-color: var(--bg-color);
        color: var(--text-main);
        cursor: none; /* Hide default cursor */
        font-family: "Space Grotesk", sans-serif;
        overflow: hidden; /* Prevent scroll bars during intro */
        height: 100vh;
        width: 100vw;
      }

      /* Luxury Typography Utility */
      .font-serif {
        font-family: "Cormorant Garamond", serif;
      }
      .font-sans {
        font-family: "Space Grotesk", sans-serif;
      }

      /* Custom Cursor */
      #cursor {
        position: fixed;
        top: 0;
        left: 0;
        width: var(--cursor-size);
        height: var(--cursor-size);
        border: 1px solid var(--text-main);
        border-radius: 50%;
        pointer-events: none;
        z-index: 9999;
        transform: translate(-50%, -50%);
        transition: width 0.2s, height 0.2s, background-color 0.2s;
        mix-blend-mode: difference;
      }
      #cursor.active {
        width: 50px;
        height: 50px;
        background-color: rgba(255, 255, 255, 0.1);
        border-color: var(--accent);
      }

      /* Chat Container Layout */
      .chat-wrapper {
        display: flex;
        flex-direction: column;
        height: 100%;
        max-width: 900px;
        margin: 0 auto;
        padding: 2rem;
        position: relative;
      }

      /* Message Bubbles - Architectural Style */
      .msg-bot {
        align-self: flex-start;
        max-width: 80%;
        margin-bottom: 2rem;
        opacity: 0; /* GSAP handle */
        transform: translateY(20px);
      }
      .msg-bot-text {
        font-size: 1.5rem; /* Larger, editorial font size */
        line-height: 1.3;
        font-family: "Cormorant Garamond", serif;
        font-weight: 400;
        color: var(--text-main);
      }
      .msg-bot-meta {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: #888;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .msg-user {
        align-self: flex-end;
        background: var(--text-main);
        color: var(--bg-color);
        padding: 1rem 1.5rem;
        border-radius: 2px; /* Brutalist corners */
        max-width: 60%;
        margin-bottom: 2rem;
        box-shadow: 10px 10px 0px rgba(0, 0, 0, 0.05);
        opacity: 0;
        transform: translateY(20px);
      }

      /* Input Area */
      .input-area {
        margin-top: auto;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
        padding-top: 2rem;
      }

      /* Choice Buttons */
      .choice-btn {
        border: 1px solid var(--text-main);
        background: transparent;
        color: var(--text-main);
        padding: 0.75rem 1.5rem;
        font-family: "Space Grotesk", sans-serif;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }
      .choice-btn:hover {
        background: var(--text-main);
        color: var(--bg-color);
        padding-left: 2rem;
      }
      .choice-btn::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 4px;
        background: var(--accent);
        transform: scaleY(0);
        transition: transform 0.2s;
      }
      .choice-btn:hover::before {
        transform: scaleY(1);
      }

      /* Typing Indicator */
      .typing-dot {
        width: 4px;
        height: 4px;
        background-color: var(--text-main);
        border-radius: 50%;
        display: inline-block;
        margin: 0 2px;
        animation: typing 1.4s infinite ease-in-out both;
      }
      .typing-dot:nth-child(1) {
        animation-delay: -0.32s;
      }
      .typing-dot:nth-child(2) {
        animation-delay: -0.16s;
      }
      @keyframes typing {
        0%,
        80%,
        100% {
          transform: scale(0);
        }
        40% {
          transform: scale(1);
        }
      }

      /* Scrollbar */
      ::-webkit-scrollbar {
        width: 6px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #ccc;
        border-radius: 3px;
      }

      /* Noise Overlay for texture */
      .noise {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E");
        z-index: 50;
      }
    </style>
  </head>
  <body>
    <!-- Custom Cursor -->
    <div id="cursor"></div>

    <!-- Noise Texture -->
    <div class="noise"></div>

    <div id="app" class="h-full relative z-10">
      <!-- Header -->
      <header
        class="absolute top-0 left-0 w-full p-8 flex justify-between items-center z-20"
      >
        <div class="flex items-center gap-2">
          <i data-lucide="gem" class="w-5 h-5 text-gray-800"></i>
          <span class="font-sans font-bold tracking-widest text-xs uppercase"
            >ATELIER T3</span
          >
        </div>
        <div class="text-xs font-sans text-gray-400 tracking-widest">
          {{ currentDate }}
        </div>
      </header>

      <!-- Main Chat Interface -->
      <div class="chat-wrapper">
        <!-- Messages Area -->
        <div
          ref="messagesContainer"
          class="flex-1 overflow-y-auto pb-4 pr-2 pt-20"
        >
          <div
            v-for="(msg, index) in messages"
            :key="index"
            :class="msg.sender === 'bot' ? 'msg-bot' : 'msg-user'"
            class="message-item"
          >
            <!-- Bot Meta Header -->
            <div v-if="msg.sender === 'bot'" class="msg-bot-meta">
              <i data-lucide="bot" class="w-3 h-3"></i>
              <span>SYSTEM ARCHITECT</span>
            </div>

            <!-- Content -->
            <div
              :class="msg.sender === 'bot' ? 'msg-bot-text' : 'font-sans font-light'"
            >
              {{ msg.text }}
            </div>
          </div>

          <!-- Typing Indicator -->
          <div
            v-if="isTyping"
            class="msg-bot"
            style="opacity: 1; transform: none"
          >
            <div class="msg-bot-meta">
              <span>CALCULATING</span>
            </div>
            <div class="msg-bot-text">
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
            </div>
          </div>
        </div>

        <!-- Interactions Area -->
        <div class="input-area min-h-[150px]">
          <transition
            enter-active-class="transition duration-500 ease-out"
            enter-from-class="transform translate-y-4 opacity-0"
            enter-to-class="transform translate-y-0 opacity-100"
            leave-active-class="transition duration-300 ease-in"
            leave-from-class="transform translate-y-0 opacity-100"
            leave-to-class="transform translate-y-4 opacity-0"
          >
            <!-- Options Mode -->
            <div
              v-if="currentOptions.length > 0 && !isTyping"
              class="flex flex-wrap gap-4"
            >
              <button
                v-for="(option, idx) in currentOptions"
                :key="idx"
                @mouseenter="hoverSound"
                @click="selectOption(option)"
                class="choice-btn"
              >
                {{ option.label }}
              </button>
            </div>

            <!-- Text Input Mode (Optional for custom requests) -->
            <div
              v-else-if="waitingForText && !isTyping"
              class="flex w-full border-b border-gray-800 pb-2"
            >
              <input
                v-model="userTextInput"
                @keydown.enter="sendText"
                type="text"
                class="w-full bg-transparent border-none outline-none font-serif text-2xl placeholder-gray-300 text-gray-900"
                placeholder="Type your specifics..."
                autofocus
              />
              <button
                @click="sendText"
                @mouseenter="hoverSound"
                class="ml-4 uppercase text-xs font-bold tracking-widest hover:text-[#cd5c45] transition-colors"
              >
                Transmit <i data-lucide="arrow-right" class="inline w-3 h-3"></i>
              </button>
            </div>
          </transition>
        </div>
      </div>
    </div>

    <script>
      const { createApp, ref, onMounted, nextTick, computed } = Vue;

      createApp({
        setup() {
          const messages = ref([]);
          const isTyping = ref(false);
          const currentOptions = ref([]);
          const waitingForText = ref(false);
          const userTextInput = ref("");
          const messagesContainer = ref(null);
          
          // Form State
          const formData = ref({
            purpose: "",
            workType: "",
            resolution: "",
            aesthetic: "",
          });

          // Sound Context
          let audioCtx;
          
          const initAudio = () => {
            if (!audioCtx) {
              audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
          };

          const playTone = (freq, type, duration) => {
            if (!audioCtx) initAudio();
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            
            gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
          };

          const clickSound = () => {
             // Mechanical switch sound simulation
             playTone(600, 'square', 0.05);
             setTimeout(() => playTone(300, 'triangle', 0.1), 30);
          };

          const hoverSound = () => {
             // Subtle high tech blip
             playTone(1200, 'sine', 0.05);
          };

          const messageSound = () => {
            // Soft notification chime
            playTone(400, 'sine', 0.3);
            setTimeout(() => playTone(800, 'sine', 0.4), 100);
          }

          // Script Flow
          const flow = {
            start: {
              text: "Greetings. I am T3, the curator of the Atelier. To engineer a system that aligns with your ambitions, I require some context. Shall we begin the specification process?",
              options: [{ label: "Commence Design", next: "purpose" }]
            },
            purpose: {
              text: "A machine is defined by its burden. Will this system primarily serve as an instrument of leisure (Gaming), or a tool of profession?",
              options: [
                { label: "Pure Gaming", next: "resolution", action: () => formData.value.purpose = "Gaming" },
                { label: "Professional Workstation", next: "work_type", action: () => formData.value.purpose = "Workstation" },
                { label: "Hybrid Architecture", next: "work_type", action: () => formData.value.purpose = "Hybrid" }
              ]
            },
            work_type: {
              text: "Precision requires detail. Which suite of applications demands the most from your silicone?",
              options: [
                { label: "3D Rendering / CAD", next: "resolution", action: () => formData.value.workType = "3D" },
                { label: "Video Production", next: "resolution", action: () => formData.value.workType = "Video" },
                { label: "Software Engineering", next: "resolution", action: () => formData.value.workType = "Code" },
                { label: "General Executive", next: "resolution", action: () => formData.value.workType = "General" }
              ]
            },
            resolution: {
              text: "Visual fidelity is the window to the soul. What is your target canvas resolution?",
              options: [
                { label: "1080p High-Refresh (eSports)", next: "aesthetic", action: () => formData.value.resolution = "1080p" },
                { label: "1440p Balanced", next: "aesthetic", action: () => formData.value.resolution = "1440p" },
                { label: "4K Ultra Fidelity", next: "aesthetic", action: () => formData.value.resolution = "4K" }
              ]
            },
            aesthetic: {
              text: "Finally, aesthetics. The chassis should reflect the user. Which material philosophy resonates with you?",
              options: [
                { label: "Stealth Graphite (Black)", next: "open_text", action: () => formData.value.aesthetic = "Black" },
                { label: "Porcelain & Chrome (White)", next: "open_text", action: () => formData.value.aesthetic = "White" },
                { label: "Industrial Glass (RGB)", next: "open_text", action: () => formData.value.aesthetic = "RGB" }
              ]
            },
            open_text: {
              text: "Is there any specific title, software, or unique requirement our engineers should be aware of?",
              input: true,
              next: "finish"
            },
            finish: {
              text: "Specification locked. I am compiling your blueprint now. A specialist will review these parameters and present a bespoke configuration shortly.",
              options: []
            }
          };

          const addMessage = (text, sender = 'bot', delay = 0) => {
            return new Promise((resolve) => {
              if (sender === 'bot') isTyping.value = true;
              
              setTimeout(() => {
                isTyping.value = false;
                messages.value.push({ text, sender });
                if(sender === 'bot') messageSound();
                
                nextTick(() => {
                  // Scroll to bottom
                  const container = messagesContainer.value;
                  container.scrollTo({ top: container.scrollHeight, behavior: 'smooth' });
                  
                  // Animate Entry
                  const newMsgs = document.querySelectorAll('.message-item');
                  const lastMsg = newMsgs[newMsgs.length - 1];
                  gsap.to(lastMsg, { opacity: 1, y: 0, duration: 0.6, ease: "power2.out" });
                  
                  // Re-init icons for new content
                  lucide.createIcons();
                });
                resolve();
              }, delay);
            });
          };

          const nextStep = async (stepKey) => {
            currentOptions.value = [];
            waitingForText.value = false;
            
            const stepData = flow[stepKey];
            if (!stepData) return;

            // Simulating "thinking" time
            await addMessage(stepData.text, 'bot', 800);

            if (stepData.options) {
              setTimeout(() => {
                 currentOptions.value = stepData.options;
              }, 400); // Slight delay before options appear
            } else if (stepData.input) {
              setTimeout(() => {
                waitingForText.value = true;
              }, 400);
            }
          };

          const selectOption = (option) => {
            clickSound();
            addMessage(option.label, 'user');
            currentOptions.value = []; // clear options immediately
            
            if(option.action) option.action();
            
            if (option.next) {
              nextStep(option.next);
            }
          };

          const sendText = () => {
            if(!userTextInput.value.trim()) return;
            clickSound();
            addMessage(userTextInput.value, 'user');
            userTextInput.value = "";
            waitingForText.value = false;
            nextStep("finish");
          };

          // Time formatting
          const currentDate = computed(() => {
            return new Date().toLocaleDateString('en-GB', { 
              weekday: 'short', year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'
            }).toUpperCase();
          });

          // Cursor Logic
          const setupCursor = () => {
            const cursor = document.getElementById('cursor');
            
            document.addEventListener('mousemove', (e) => {
              cursor.style.left = e.clientX + 'px';
              cursor.style.top = e.clientY + 'px';
            });

            // Hover effects
            const addHover = () => cursor.classList.add('active');
            const removeHover = () => cursor.classList.remove('active');

            document.body.addEventListener('mouseover', (e) => {
              if (e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT' || e.target.closest('.choice-btn')) {
                addHover();
              } else {
                removeHover();
              }
            });
          };

          onMounted(() => {
            setupCursor();
            lucide.createIcons();
            // Start conversation
            nextStep('start');
          });

          return {
            messages,
            isTyping,
            currentOptions,
            selectOption,
            waitingForText,
            userTextInput,
            sendText,
            messagesContainer,
            hoverSound,
            currentDate
          };
        }
      }).mount('#app');
    </script>
  </body>
</html>